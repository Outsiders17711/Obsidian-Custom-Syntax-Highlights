/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var E=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var j=(s,e)=>{for(var t in e)E(s,t,{get:e[t],enumerable:!0})},D=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of H(e))!O.call(s,i)&&i!==t&&E(s,i,{get:()=>e[i],enumerable:!(n=A(e,i))||n.enumerable});return s};var N=s=>D(E({},"__esModule",{value:!0}),s);var B={};j(B,{default:()=>w});module.exports=N(B);var z=require("obsidian");var c=require("obsidian");function h(s){let e=s.lastIndexOf(".");return e===-1?null:s.substring(e+1).toLowerCase()}function u(s){return s.toLowerCase()==="md"}function p(s,e){return u(s)?!1:e.extensionMappings.some(t=>t.extension.toLowerCase()===s.toLowerCase())}function d(s,e){let t=h(s);if(!t)return"text";let n=e.extensionMappings.find(i=>i.extension.toLowerCase()===t.toLowerCase());return n?n.language&&n.language.trim()?n.language:t:"text"}function L(s){return s.extensionMappings.map(e=>e.extension).filter(e=>e.length>0&&!u(e))}var v=class extends c.MarkdownRenderChild{constructor(t,n,i,a){super(n);this.plugin=t;this.ctx=i;this.sizerManager=a}onload(){(async()=>{try{let t=this.plugin.app.vault.getAbstractFileByPath(this.ctx.sourcePath);if(!(t instanceof c.TFile))return;let n=await this.plugin.app.vault.cachedRead(t),a="```"+d(this.ctx.sourcePath,this.plugin.settings)+`
`+n+"\n```";await c.MarkdownRenderer.render(this.plugin.app,a,this.containerEl,this.ctx.sourcePath,this)}catch(t){console.error("custom-syntax-highlights: reading render failed",t)}})()}onunload(){this.cleanupStyles()}cleanupStyles(){var o;let t=this.containerEl,n=t.closest(".markdown-preview-view"),i=t.parentElement;(o=n==null?void 0:n.classList)==null||o.remove("csh-mode"),i&&this.sizerManager.has(i)&&(this.sizerManager.delete(i),i.classList.remove("csh-sizer-adjusted"));let a=n==null?void 0:n.querySelectorAll(".csh-hidden");a==null||a.forEach(r=>{r.classList.remove("csh-hidden")}),t.classList.remove("csh-first-section")}};function T(s,e){return(t,n)=>{var M,y;let i=(M=n.sourcePath)==null?void 0:M.toLowerCase();if(!i)return;let a=h(i);if(!a||!p(a,s.settings))return;let o=d(i,s.settings);if(o==="md"||o==="markdown")return;let r=(y=n.getSectionInfo)==null?void 0:y.call(n,t);if(!r)return;let l=t;if(r.lineStart!==0){V(l);return}if(l.classList.contains("csh-rendered"))return;l.classList.add("csh-rendered"),W(e,l);let R=new v(s,l,n,e);n.addChild(R)}}function V(s){if(!s.classList.contains("csh-hidden"))for(s.classList.add("csh-hidden");s.firstChild;)s.removeChild(s.firstChild)}function W(s,e){let t=e.parentElement,n=e.closest(".markdown-preview-view");for(n==null||n.classList.add("csh-mode"),t&&!s.has(t)&&(s.add(t),t.classList.add("csh-sizer-adjusted")),e.classList.add("csh-first-section");e.firstChild;)e.removeChild(e.firstChild)}var C={extensionMappings:[{extension:"tex",language:""},{extension:"json",language:""},{extension:"yaml",language:""},{extension:"bib",language:"ini"},{extension:"txt",language:"md"}],autoSwitchToReading:!0};function k(s){let e=s.toLowerCase().replace(/[^a-z0-9_]/g,"");return e==="md"?"":e}function b(s){return s.trim()}var g=require("obsidian");var m=class extends g.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new g.Setting(e).setName("Custom file extensions").setHeading().settingEl.addClass("csh-h2"),e.createEl("p",{text:"Configure file extensions to display as syntax-highlighted code blocks in reading view."}),new g.Setting(e).setName("Auto-switch to reading view").setDesc("Automatically switch files with configured extensions to reading view when opened").addToggle(o=>o.setValue(this.plugin.settings.autoSwitchToReading).onChange(async r=>{this.plugin.settings.autoSwitchToReading=r,await this.plugin.saveSettings()})),new g.Setting(e).setName("Extension mappings").setHeading().settingEl.addClass("csh-h2"),e.createEl("p",{text:"Define which file extensions should be displayed with which syntax highlighting language. Leave language empty to use the extension name."});let t=e.createEl("div",{cls:"setting-item-description csh-settings-note"});t.createEl("strong",{text:"Note: "}),t.appendText("The '.md' extension is not supported as it's handled natively by Obsidian. Set language to 'md' or 'markdown' for any non-native extension to allow normal editing and disable both syntax highlighting and auto-switch to reading view."),this.plugin.settings.extensionMappings.forEach((o,r)=>{this.createMappingSetting(e,o,r)}),new g.Setting(e).setName("Add new extension mapping").setDesc("Add a new file extension to language mapping").addButton(o=>o.setButtonText("Add mapping").setCta().onClick(async()=>{this.plugin.settings.extensionMappings.push({extension:"",language:""}),await this.plugin.saveSettings(),this.display()})),new g.Setting(e).setName("Examples").setHeading().settingEl.addClass("csh-h2");let n=e.createEl("div",{cls:"csh-settings-examples"});n.createEl("p",{text:"Common mappings:"});let i=["json \u2192 json (or leave empty)","bib \u2192 ini","py \u2192 python","js \u2192 javascript","txt \u2192 md (enable normal editing, disable syntax highlighting & auto-reading view)"],a=n.createEl("ul");i.forEach(o=>{a.createEl("li",{text:o})})}createMappingSetting(e,t,n){let i=new g.Setting(e).setName(`Extension mapping ${n+1}`).setDesc("File extension and corresponding syntax highlighting language");i.addText(a=>a.setPlaceholder("file extension (`tex`, `json`, `bib`)").setValue(t.extension).onChange(async o=>{let r=k(o);t.extension=r,a.setValue(r),await this.plugin.saveSettings(),this.plugin.refreshExtensionRegistrations()})),i.addText(a=>a.setPlaceholder("syntax language (`tex`, `json`, `ini`) - leave empty to use extension").setValue(t.language).onChange(async o=>{t.language=b(o),await this.plugin.saveSettings()})),i.addButton(a=>a.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.extensionMappings.splice(n,1),await this.plugin.saveSettings(),this.plugin.refreshExtensionRegistrations(),this.display()}))}};var x=class{constructor(){this.processedSizers=new WeakSet}has(e){return this.processedSizers.has(e)}add(e){this.processedSizers.add(e)}delete(e){this.processedSizers.delete(e)}clear(){this.processedSizers=new WeakSet}};var S=require("obsidian");function P(s,e){return s.on("file-open",t=>{if(e.autoSwitchToReading&&t instanceof S.TFile&&p(t.extension,e)){let n=d(t.path,e);if(n==="md"||n==="markdown")return;let i=s.getLeavesOfType("markdown");for(let a of i){let o=a.view;if(o.file===t){o.setState({mode:"preview"},{history:!1});break}}}})}function F(s,e){if(!e.autoSwitchToReading)return;let t=s.getLeavesOfType("markdown");for(let n of t){let i=n.view;if(i.file instanceof S.TFile&&p(i.file.extension,e)){let a=d(i.file.path,e);if(a==="md"||a==="markdown")continue;i.setState({mode:"preview"},{history:!1})}}}var f=class{constructor(e){this.plugin=e;this.registeredExtensions=new Set}refreshExtensionRegistrations(e){let t=L(e);for(let n of t)if(!this.registeredExtensions.has(n))try{this.plugin.registerExtensions([n],"markdown"),this.registeredExtensions.add(n),console.debug(`custom-syntax-highlights: registered extension .${n}`)}catch(i){console.debug(`custom-syntax-highlights: extension .${n} already registered by another plugin`)}}clear(){this.registeredExtensions.clear()}getRegisteredExtensions(){return new Set(this.registeredExtensions)}};var w=class extends z.Plugin{constructor(){super(...arguments);this.sizerManager=new x}async onload(){await this.loadSettings(),this.extensionManager=new f(this),this.addSettingTab(new m(this.app,this)),this.refreshExtensionRegistrations(),this.registerEvent(P(this.app.workspace,this.settings)),this.registerMarkdownPostProcessor(T(this,this.sizerManager)),this.applyToAllOpen()}refreshExtensionRegistrations(){this.extensionManager.refreshExtensionRegistrations(this.settings),this.applyToAllOpen()}applyToAllOpen(){F(this.app.workspace,this.settings)}async loadSettings(){this.settings=Object.assign({},C,await this.loadData());let t=!1,n=this.settings.extensionMappings.length;this.settings.extensionMappings=this.settings.extensionMappings.filter(i=>i.extension.toLowerCase()!=="md"),this.settings.extensionMappings.length!==n&&(t=!0);for(let i of this.settings.extensionMappings)i.language==="text"&&i.extension!=="text"&&(i.language="",t=!0);t&&await this.saveSettings()}async saveSettings(){await this.saveData(this.settings)}};

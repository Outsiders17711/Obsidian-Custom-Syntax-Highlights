/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var E=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var j=(s,t)=>{for(var e in t)E(s,e,{get:t[e],enumerable:!0})},D=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of R(t))!O.call(s,i)&&i!==e&&E(s,i,{get:()=>t[i],enumerable:!(n=A(t,i))||n.enumerable});return s};var V=s=>D(E({},"__esModule",{value:!0}),s);var B={};j(B,{default:()=>w});module.exports=V(B);var H=require("obsidian");var c=require("obsidian");function h(s){let t=s.lastIndexOf(".");return t===-1?null:s.substring(t+1).toLowerCase()}function u(s){return s.toLowerCase()==="md"}function d(s,t){return u(s)?!1:t.extensionMappings.some(e=>e.extension.toLowerCase()===s.toLowerCase())}function g(s,t){let e=h(s);if(!e)return"text";let n=t.extensionMappings.find(i=>i.extension.toLowerCase()===e.toLowerCase());return n?n.language&&n.language.trim()?n.language:e:"text"}function L(s){return s.extensionMappings.map(t=>t.extension).filter(t=>t.length>0&&!u(t))}var v=class extends c.MarkdownRenderChild{constructor(e,n,i,a){super(n);this.plugin=e;this.ctx=i;this.sizerManager=a}async onload(){try{let e=this.plugin.app.vault.getAbstractFileByPath(this.ctx.sourcePath);if(!(e instanceof c.TFile))return;let n=await this.plugin.app.vault.cachedRead(e),a="```"+g(this.ctx.sourcePath,this.plugin.settings)+`
`+n+"\n```";await c.MarkdownRenderer.render(this.plugin.app,a,this.containerEl,this.ctx.sourcePath,this.plugin)}catch(e){console.error("custom-syntax-highlights: reading render failed",e)}}onunload(){this.cleanupStyles()}cleanupStyles(){var o;let e=this.containerEl,n=e.closest(".markdown-preview-view"),i=e.parentElement;(o=n==null?void 0:n.classList)==null||o.remove("csh-mode"),i&&this.sizerManager.has(i)&&(this.sizerManager.delete(i),i.classList.remove("csh-sizer-adjusted"));let a=n==null?void 0:n.querySelectorAll(".csh-hidden");a==null||a.forEach(r=>{r.classList.remove("csh-hidden")}),e.classList.remove("csh-first-section")}};function T(s,t){return(e,n)=>{var M,y;let i=(M=n.sourcePath)==null?void 0:M.toLowerCase();if(!i)return;let a=h(i);if(!a||!d(a,s.settings))return;let o=g(i,s.settings);if(o==="md"||o==="markdown")return;let r=(y=n.getSectionInfo)==null?void 0:y.call(n,e);if(!r)return;let l=e;if(r.lineStart!==0){N(l);return}if(l.classList.contains("csh-rendered"))return;l.classList.add("csh-rendered"),W(t,l);let z=new v(s,l,n,t);n.addChild(z)}}function N(s){if(!s.classList.contains("csh-hidden"))for(s.classList.add("csh-hidden");s.firstChild;)s.removeChild(s.firstChild)}function W(s,t){let e=t.parentElement,n=t.closest(".markdown-preview-view");for(n==null||n.classList.add("csh-mode"),e&&!s.has(e)&&(s.add(e),e.classList.add("csh-sizer-adjusted")),t.classList.add("csh-first-section");t.firstChild;)t.removeChild(t.firstChild)}var k={extensionMappings:[{extension:"tex",language:""},{extension:"json",language:""},{extension:"yaml",language:""},{extension:"bib",language:"ini"},{extension:"txt",language:"md"}],autoSwitchToReading:!0};function C(s){let t=s.toLowerCase().replace(/[^a-z0-9_]/g,"");return t==="md"?"":t}function b(s){return s.trim()}var p=require("obsidian");var m=class extends p.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Custom File Extensions Settings"}),e.createEl("p",{text:"Configure file extensions to display as syntax-highlighted code blocks in reading view."}),new p.Setting(e).setName("Auto-switch to reading view").setDesc("Automatically switch files with configured extensions to reading view when opened").addToggle(r=>r.setValue(this.plugin.settings.autoSwitchToReading).onChange(async l=>{this.plugin.settings.autoSwitchToReading=l,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Extension Mappings"}),e.createEl("p",{text:"Define which file extensions should be displayed with which syntax highlighting language. Leave language empty to use the extension name."});let n=e.createEl("div",{cls:"setting-item-description csh-settings-note"});n.createEl("strong",{text:"Note: "}),n.appendText("The '.md' extension is not supported as it's handled natively by Obsidian. Set language to 'md' or 'markdown' for any non-native extension to allow normal editing and disable both syntax highlighting and auto-switch to reading view."),this.plugin.settings.extensionMappings.forEach((r,l)=>{this.createMappingSetting(e,r,l)}),new p.Setting(e).setName("Add new extension mapping").setDesc("Add a new file extension to language mapping").addButton(r=>r.setButtonText("Add mapping").setCta().onClick(async()=>{this.plugin.settings.extensionMappings.push({extension:"",language:""}),await this.plugin.saveSettings(),this.display()})),e.createEl("h4",{text:"Examples"});let i=e.createEl("div",{cls:"csh-settings-examples"});i.createEl("p",{text:"Common mappings:"});let a=["json \u2192 json (or leave empty)","bib \u2192 ini","py \u2192 python","js \u2192 javascript","txt \u2192 md (enable normal editing, disable syntax highlighting & auto-reading view)"],o=i.createEl("ul");a.forEach(r=>{o.createEl("li",{text:r})})}createMappingSetting(e,n,i){let a=new p.Setting(e).setName(`Extension mapping ${i+1}`).setDesc("File extension and corresponding syntax highlighting language");a.addText(o=>o.setPlaceholder("Extension (e.g., tex, json, bib)").setValue(n.extension).onChange(async r=>{let l=C(r);n.extension=l,o.setValue(l),await this.plugin.saveSettings(),await this.plugin.refreshExtensionRegistrations()})),a.addText(o=>o.setPlaceholder("Language (e.g., tex, json, ini) - leave empty to use extension").setValue(n.language).onChange(async r=>{n.language=b(r),await this.plugin.saveSettings()})),a.addButton(o=>o.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.extensionMappings.splice(i,1),await this.plugin.saveSettings(),await this.plugin.refreshExtensionRegistrations(),this.display()}))}};var x=class{constructor(){this.processedSizers=new WeakSet}has(t){return this.processedSizers.has(t)}add(t){this.processedSizers.add(t)}delete(t){this.processedSizers.delete(t)}clear(){this.processedSizers=new WeakSet}};var S=require("obsidian");function F(s,t){return s.on("file-open",e=>{if(t.autoSwitchToReading&&e instanceof S.TFile&&d(e.extension,t)){let n=g(e.path,t);if(n==="md"||n==="markdown")return;let i=s.getLeavesOfType("markdown");for(let a of i){let o=a.view;if(o.file===e){o.setState({mode:"preview"},{history:!1});break}}}})}function P(s,t){if(!t.autoSwitchToReading)return;let e=s.getLeavesOfType("markdown");for(let n of e){let i=n.view;if(i.file instanceof S.TFile&&d(i.file.extension,t)){let a=g(i.file.path,t);if(a==="md"||a==="markdown")continue;i.setState({mode:"preview"},{history:!1})}}}var f=class{constructor(t){this.plugin=t;this.registeredExtensions=new Set}async refreshExtensionRegistrations(t){let e=L(t);for(let n of e)if(!this.registeredExtensions.has(n))try{this.plugin.registerExtensions([n],"markdown"),this.registeredExtensions.add(n),console.debug(`custom-syntax-highlights: registered extension .${n}`)}catch(i){console.debug(`custom-syntax-highlights: extension .${n} already registered by another plugin`)}}clear(){this.registeredExtensions.clear()}getRegisteredExtensions(){return new Set(this.registeredExtensions)}};var w=class extends H.Plugin{constructor(){super(...arguments);this.sizerManager=new x}async onload(){await this.loadSettings(),this.extensionManager=new f(this),this.addSettingTab(new m(this.app,this)),await this.refreshExtensionRegistrations(),this.registerEvent(F(this.app.workspace,this.settings)),this.registerMarkdownPostProcessor(T(this,this.sizerManager)),this.applyToAllOpen()}async refreshExtensionRegistrations(){await this.extensionManager.refreshExtensionRegistrations(this.settings),this.applyToAllOpen()}applyToAllOpen(){P(this.app.workspace,this.settings)}async loadSettings(){this.settings=Object.assign({},k,await this.loadData());let e=!1,n=this.settings.extensionMappings.length;this.settings.extensionMappings=this.settings.extensionMappings.filter(i=>i.extension.toLowerCase()!=="md"),this.settings.extensionMappings.length!==n&&(e=!0);for(let i of this.settings.extensionMappings)i.language==="text"&&i.extension!=="text"&&(i.language="",e=!0);e&&await this.saveSettings()}async saveSettings(){await this.saveData(this.settings)}};

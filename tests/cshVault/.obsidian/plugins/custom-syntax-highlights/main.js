/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var y=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var D=(s,t)=>{for(var e in t)y(s,e,{get:t[e],enumerable:!0})},j=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of R(t))!O.call(s,i)&&i!==e&&y(s,i,{get:()=>t[i],enumerable:!(n=z(t,i))||n.enumerable});return s};var B=s=>j(y({},"__esModule",{value:!0}),s);var W={};D(W,{default:()=>E});module.exports=B(W);var A=require("obsidian");var p=require("obsidian");function d(s){let t=s.lastIndexOf(".");return t===-1?null:s.substring(t+1).toLowerCase()}function m(s){return s.toLowerCase()==="md"}function c(s,t){return m(s)?!1:t.extensionMappings.some(e=>e.extension.toLowerCase()===s.toLowerCase())}function g(s,t){let e=d(s);if(!e)return"text";let n=t.extensionMappings.find(i=>i.extension.toLowerCase()===e.toLowerCase());return n?n.language&&n.language.trim()?n.language:e:"text"}function T(s){return s.extensionMappings.map(t=>t.extension).filter(t=>t.length>0&&!m(t))}var v=class extends p.MarkdownRenderChild{constructor(e,n,i,a){super(n);this.plugin=e;this.ctx=i;this.sizerManager=a}async onload(){try{let e=this.plugin.app.vault.getAbstractFileByPath(this.ctx.sourcePath);if(!(e instanceof p.TFile))return;let n=await this.plugin.app.vault.cachedRead(e),a="```"+g(this.ctx.sourcePath,this.plugin.settings)+`
`+n+"\n```";await p.MarkdownRenderer.render(this.plugin.app,a,this.containerEl,this.ctx.sourcePath,this.plugin)}catch(e){console.error("custom-syntax-highlights: reading render failed",e)}}onunload(){this.cleanupStyles()}cleanupStyles(){var r;let e=this.containerEl,n=e.closest(".markdown-preview-view"),i=e.parentElement;(r=n==null?void 0:n.classList)==null||r.remove("csh-mode"),i&&this.sizerManager.has(i)&&(this.sizerManager.delete(i),i.querySelectorAll(".markdown-preview-pusher").forEach(o=>{let u=o;u.style.height="",u.style.minHeight=""}),i.style.paddingBottom="");let a=n==null?void 0:n.querySelectorAll(".csh-hidden");a==null||a.forEach(l=>{let o=l;o.classList.remove("csh-hidden"),o.style.height="",o.style.minHeight="",o.style.margin="",o.style.padding="",o.style.visibility=""})}};function k(s,t){return(e,n)=>{var M,L;let i=(M=n.sourcePath)==null?void 0:M.toLowerCase();if(!i)return;let a=d(i);if(!a||!c(a,s.settings))return;let r=g(i,s.settings);if(r==="md"||r==="markdown")return;let l=(L=n.getSectionInfo)==null?void 0:L.call(n,e);if(!l)return;let o=e;if(l.lineStart!==0){V(o);return}if(o.classList.contains("csh-rendered"))return;o.classList.add("csh-rendered"),N(t,o);let u=new v(s,o,n,t);n.addChild(u)}}function V(s){if(!s.classList.contains("csh-hidden")){for(s.classList.add("csh-hidden");s.firstChild;)s.removeChild(s.firstChild);s.style.height="1px",s.style.minHeight="1px",s.style.margin="0",s.style.padding="0",s.style.visibility="hidden"}}function N(s,t){let e=t.parentElement,n=t.closest(".markdown-preview-view");for(n==null||n.classList.add("csh-mode"),e&&!s.has(e)&&(s.add(e),e.querySelectorAll(".markdown-preview-pusher").forEach(a=>{let r=a;r.style.height="0px",r.style.minHeight="0px"}),e.style.paddingBottom="8px"),t.style.margin="0",t.style.padding="8px 0";t.firstChild;)t.removeChild(t.firstChild)}var b={extensionMappings:[{extension:"tex",language:""},{extension:"json",language:""},{extension:"yaml",language:""},{extension:"bib",language:"ini"},{extension:"txt",language:"md"}],autoSwitchToReading:!0};function C(s){let t=s.toLowerCase().replace(/[^a-z0-9_]/g,"");return t==="md"?"":t}function F(s){return s.trim()}var h=require("obsidian");var x=class extends h.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Custom File Extensions Settings"}),e.createEl("p",{text:"Configure file extensions to display as syntax-highlighted code blocks in reading view."}),new h.Setting(e).setName("Auto-switch to reading view").setDesc("Automatically switch files with configured extensions to reading view when opened").addToggle(l=>l.setValue(this.plugin.settings.autoSwitchToReading).onChange(async o=>{this.plugin.settings.autoSwitchToReading=o,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Extension Mappings"}),e.createEl("p",{text:"Define which file extensions should be displayed with which syntax highlighting language. Leave language empty to use the extension name."});let n=e.createEl("div",{cls:"setting-item-description"});n.createEl("strong",{text:"Note: "}),n.appendText("The '.md' extension is not supported as it's handled natively by Obsidian. Set language to 'md' or 'markdown' for any non-native extension to allow normal editing and disable both syntax highlighting and auto-switch to reading view."),n.style.marginBottom="20px",this.plugin.settings.extensionMappings.forEach((l,o)=>{this.createMappingSetting(e,l,o)}),new h.Setting(e).setName("Add new extension mapping").setDesc("Add a new file extension to language mapping").addButton(l=>l.setButtonText("Add mapping").setCta().onClick(async()=>{this.plugin.settings.extensionMappings.push({extension:"",language:""}),await this.plugin.saveSettings(),this.display()})),e.createEl("h4",{text:"Examples"});let i=e.createEl("div",{cls:"csh-examples"});i.createEl("p",{text:"Common mappings:"});let a=["json \u2192 json (or leave empty)","bib \u2192 ini","py \u2192 python","js \u2192 javascript","txt \u2192 md (enable normal editing, disable syntax highlighting & auto-reading view)"],r=i.createEl("ul");a.forEach(l=>{r.createEl("li",{text:l})})}createMappingSetting(e,n,i){let a=new h.Setting(e).setName(`Extension mapping ${i+1}`).setDesc("File extension and corresponding syntax highlighting language");a.addText(r=>r.setPlaceholder("Extension (e.g., tex, json, bib)").setValue(n.extension).onChange(async l=>{let o=C(l);n.extension=o,r.setValue(o),await this.plugin.saveSettings(),await this.plugin.refreshExtensionRegistrations()})),a.addText(r=>r.setPlaceholder("Language (e.g., tex, json, ini) - leave empty to use extension").setValue(n.language).onChange(async l=>{n.language=F(l),await this.plugin.saveSettings()})),a.addButton(r=>r.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.extensionMappings.splice(i,1),await this.plugin.saveSettings(),await this.plugin.refreshExtensionRegistrations(),this.display()}))}};var f=class{constructor(){this.processedSizers=new WeakSet}has(t){return this.processedSizers.has(t)}add(t){this.processedSizers.add(t)}delete(t){this.processedSizers.delete(t)}clear(){this.processedSizers=new WeakSet}};var S=require("obsidian");function H(s,t){return s.on("file-open",e=>{if(t.autoSwitchToReading&&e instanceof S.TFile&&c(e.extension,t)){let n=g(e.path,t);if(n==="md"||n==="markdown")return;let i=s.getLeavesOfType("markdown");for(let a of i){let r=a.view;if(r.file===e){r.setState({mode:"preview"},{history:!1});break}}}})}function P(s,t){if(!t.autoSwitchToReading)return;let e=s.getLeavesOfType("markdown");for(let n of e){let i=n.view;if(i.file instanceof S.TFile&&c(i.file.extension,t)){let a=g(i.file.path,t);if(a==="md"||a==="markdown")continue;i.setState({mode:"preview"},{history:!1})}}}var w=class{constructor(t){this.plugin=t;this.registeredExtensions=new Set}async refreshExtensionRegistrations(t){let e=T(t);for(let n of e)if(!this.registeredExtensions.has(n))try{this.plugin.registerExtensions([n],"markdown"),this.registeredExtensions.add(n),console.debug(`custom-syntax-highlights: registered extension .${n}`)}catch(i){console.debug(`custom-syntax-highlights: extension .${n} already registered by another plugin`)}}clear(){this.registeredExtensions.clear()}getRegisteredExtensions(){return new Set(this.registeredExtensions)}};var E=class extends A.Plugin{constructor(){super(...arguments);this.sizerManager=new f}async onload(){await this.loadSettings(),this.extensionManager=new w(this),this.addSettingTab(new x(this.app,this)),await this.refreshExtensionRegistrations(),this.registerEvent(H(this.app.workspace,this.settings)),this.registerMarkdownPostProcessor(k(this,this.sizerManager)),this.applyToAllOpen()}async refreshExtensionRegistrations(){await this.extensionManager.refreshExtensionRegistrations(this.settings),this.applyToAllOpen()}applyToAllOpen(){P(this.app.workspace,this.settings)}async loadSettings(){this.settings=Object.assign({},b,await this.loadData());let e=!1,n=this.settings.extensionMappings.length;this.settings.extensionMappings=this.settings.extensionMappings.filter(i=>i.extension.toLowerCase()!=="md"),this.settings.extensionMappings.length!==n&&(e=!0);for(let i of this.settings.extensionMappings)i.language==="text"&&i.extension!=="text"&&(i.language="",e=!0);e&&await this.saveSettings()}async saveSettings(){await this.saveData(this.settings)}};
